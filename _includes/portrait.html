{% if include.lookup %}
  {% assign member = site.members
    | where_exp: "member", "member.slug == include.lookup"
    | first
  %}
{% else %}
  {% assign member_from_data = site.members
    | where: "slug", include.id
    | first
  %}
  {% if member_from_data %}
    {% assign member = member_from_data %}
  {% else %}
    {% assign member = include %}
  {% endif %}
{% endif %}

{% assign type = site.data.types[member.role] %}


<div class="portrait-wrapper">
  <a
    {% if member.url %}
      href="{{ member.url | relative_url | uri_escape }}"
    {% endif %}
    class="portrait"
    data-style="{{ include.style }}"
    aria-label="{{ member.name | default: "member link" | regex_strip }}"
  >
    {% if type %}
      {% include icon.html icon=type.icon %}
    {% endif %}

    {% if member.image %}
      <img
        src="{{ member.image | relative_url | uri_escape }}"
        class="portrait-image"
        alt="{{ member.name | default: "member portrait" | regex_strip }}"
        loading="lazy"
        {% include fallback.html %}
      >
    {% else %}
      <img
        src="/assets/images/default-portrait.png"
        class="portrait-image"
        alt="Default member portrait"
        loading="lazy"
      >
    {% endif %}

    {% if member.name %}
      <span class="portrait-name">
        {{ member.name }}
      </span>
    {% else %}
      <span class="portrait-name">
        No name found.
      </span>
    {% endif %}

    {% if member.role %}
      <span class="portrait-role">
        {{ member.role }}
      </span>
    {% elsif type.research %}
      <span class="portrait-role">
        {{ type.research }}
      </span>
    {% else %}
      <span class="portrait-role">
        No role found.
      </span>
    {% endif %}

    {% if member.research %}
      <span class="portrait-research">
        {{ member.research }}
      </span>
    {% elsif type.research %}
      <span class="portrait-research">
        {{ type.research }}
      </span>
    {% else %}
      <span class="portrait-research">
        No research found.
      </span>
    {% endif %}

    <!-- Button-Block hier direkt nach Research eingefügt -->
    {% if member.links %}
      <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
        {% for link in member.links %}
          {% assign key = link[0] %}
          {% assign value = link[1] %}
          {% include button.html type=key link=value style="bare" %}
        {% endfor %}
      </div>
    {% else %}
      <p style="color: red; text-align: center; margin-top: 10px;">
        ⚠️ No links found for this member!
      </p>
    {% endif %}
    <!-- Ende Button-Block -->
    
  </a>
</div>
